<!DOCTYPE html>
<html>
  <head>


    <!-- HTML meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta name="author" content="pauldijou">
    <meta name="description" content="" />
    
      <meta name="keywords" content="prismic">
    

    <title>Paul Dijou - Prismic.io: responsive images inside a StructuredText</title>

    <!-- facebook open graph tags http://ogp.me/ -->
    <meta property="og:site_name" content="Paul Dijou" />
    <meta property="og:title" content="Prismic.io: responsive images inside a StructuredText" />
    <meta property="og:url" content="http://pauldijou.fr/blog/2014/08/04/prismicio-responsive-images-inside-structured-text/" />
    <meta property="og:description" content="" />
    
      <meta property="og:type" content="article" />
      <meta property="article:published_time" content="2014-08-04T00:00:00+00:00" />
    
    
      <meta property="article:author" content="Paul Dijou" />
    
    
      <meta property="article:tag" content="prismic" />
    

    <!-- twitter card tags https://dev.twitter.com/cards/markup -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@paul_dijou" />
    
      <meta name="twitter:creator" content="@paul_dijou" />
    
    <meta name="twitter:title" content="Paul Dijou - Prismic.io: responsive images inside a StructuredText" />
    <meta name="twitter:description" content="" />

    <link rel="shortcut icon" type="image/png" href="/assets/favicon-5b92c61126199f7d62a67cca38b3e33bbdd0f7a7a836dbda27ef0f09ffd3e5eb.ico"/>
    <link type="text/css" rel="stylesheet" href="/assets/css/main-e66cbeb83467c4596e317baff024f2f5aafbe0950e29acbcca992eddbcabe00c.css">
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400' rel='stylesheet' type='text/css'/>

    <!--[if lt IE 8]>
      <link href="/stylesheets/ie.css" media="screen, projection" rel="stylesheet" type="text/css">
    <![endif]-->

    

    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-25058935-1', 'auto');
        ga('send', 'pageview');
      </script>
    
  </head>
  <body>
    <header id="nav" class="nav">
  <ul class="list-unstyled">
    
      <li>
        <a href="/">
          <span class="icon fa fa-home fa-fw fa-2x"></span>
          <span class="nav-label">Home</span>
        </a>
      </li>
    
      <li>
        <a href="/blog/">
          <span class="icon fa fa-coffee fa-fw fa-2x"></span>
          <span class="nav-label">Blog</span>
        </a>
      </li>
    
      <li>
        <a href="/resume/">
          <span class="icon fa fa-code fa-fw fa-2x"></span>
          <span class="nav-label">Resume</span>
        </a>
      </li>
    
      <li>
        <a href="/projects/">
          <span class="icon fa fa-flask fa-fw fa-2x"></span>
          <span class="nav-label">Projects</span>
        </a>
      </li>
    
      <li>
        <a href="/about/">
          <span class="icon fa fa-user fa-fw fa-2x"></span>
          <span class="nav-label">About</span>
        </a>
      </li>
    
      <li>
        <a href="/contact/">
          <span class="icon fa fa-envelope fa-fw fa-2x"></span>
          <span class="nav-label">Contact</span>
        </a>
      </li>
    
      <li>
        <a href="/archives/">
          <span class="icon fa fa-archive fa-fw fa-2x"></span>
          <span class="nav-label">Archives</span>
        </a>
      </li>
    
    <li class="nav-back">
      <a href="#">
        <span class="icon fa fa-undo fa-fw fa-2x"></span>
        <span class="nav-label">Back to page</span>
      </a>
    </li>
  </ul>
</header>

<div class="nav-menu">
  <a href="#nav">Menu</a>
</div>

<div class="page container">
  











<article class="post">
  <h2>
    <a href="/blog/2014/08/04/prismicio-responsive-images-inside-structured-text/">Prismic.io: responsive images inside a StructuredText</a>
  </h2>

  <div class="meta">
    Posted by
    <span class="author">Paul Dijou</span>
    
      on
      <span class="date">Aug 04, 2014</span>
    
    <span class="separator"></span>

    
      <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-comments fa-fw"></span></span>
      <a href="/blog/2014/08/04/prismicio-responsive-images-inside-structured-text/#disqus_thread" data-disqus-identifier="/blog/2014/08/04/prismicio-responsive-images-inside-structured-text">Comments</a>
      <span class="separator"></span>
    

    <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-pencil-square-o fa-fw"></span></span>
    <a class="improve visible-md-inline visible-lg-inline" href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-08-04-prismicio-responsive-images-inside-structured-text.md" target="_blank">Improve this article</a>
  </div>

  <div class="content">
    <p>Once again, I will not explain what <a href="http://prismic.io">prismic.io</a> is (but it’s a tool to manage your website content), I will only focus on one limitation and how to solve it. If you don’t know about prismic.io, you should quickly check its website before reading any further.</p>

<h3 id="whats-the-problem">What’s the problem?</h3>

<p>In prismic.io, you are creating Documents which are composed of Fragments. A fragment is data organized in a more or less semantic way. For example, a fragment can be a Number, or a Date, … Among them, there is the type Image which is really nice because you can not only fully resize / crop your raw picture, but also add smaller images based on the original one for responsive purpose. You can upload your awesome photo of this beautiful sunset, fully sized at 4000 x 3000 pixels, resize it for desktop at 1920 x 1080, and finally add a mobile version at 320 * 480. Note that the last one doesn’t respect the ratio at all, but that’s the goal: you are creating a subset of your image with the best match possible regarding the targeted screen.</p>

<p>Another really powerful fragment in prismic is the StructuredText. It allows you to have a nice WYSIWYG editor inside which you will put new fragments (paragraphs, links, titles, images, …). It would be perfect if the image fragment inside a StructuredText was a real Image fragment, but it is not. You cannot specify any thumbnail. Meaning your content cannot be responsive at all. Your choice is: consume all the bandwith for mobiles with awesome full HD images or make the eyes of your desktop users bleed with super compressed images.</p>

<h3 id="you-dont-want-to-do-that">You don’t want to do that!</h3>

<p>And me neither! I want to have responsive images inside my StructuredText for God sake. I love tools which make my life easier, but they never should stand on my way to craft the best website possible. I will not lie to you, I couldn’t find any solution that integrates nicely with the WYSIWYG editor since there is no way to extend it. The following solution will be a bit of hacking and your writers might complain about it at first.</p>

<p>So, what’s the idea? The only way to have responsive images is to use a real Image fragment, no choice here. So let’s create one, and let’s put it inside a Group fragment. This way, you can add and remove as many images as you want and they will all be responsive. Wait, you can’t do that inside the StructuredText, right? Indeed, that’s why we will do outside of it and then find a way to bring back the images inside of it. Here is the mask for such a group:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"Images"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"images"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Group"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"fieldset"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Images"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"config"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"fields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Text"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"config"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Name"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="s2">"caption"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Text"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"config"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Caption"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="s2">"image"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Image"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"config"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"thumbnails"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mobile"</span><span class="w">
              </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tablet"</span><span class="w">
              </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p class="alert alert-info"><strong>Pro Tip</strong> - When creating thumbnails for an Image fragment, the <a href="https://developers.prismic.io/documentation/UjBeuLGIJ3EKtgBV/repository-administrators-manual#document-masks">offical documentation</a> states that both width and height are mandatory. This is <strong>wrong</strong>, you can specify only one of the two or even none of them. Your UI might be a bit ugly (the resized thumbnails will only display after saving your draft) and sometimes you will have to click twice on a button (this one, I really don’t understand) but otherwise, it works just fine. I hope prismic guys will make those attributes optional because… well… how can you anticipate how the writer wants to resize its image?</p>

<p>As you can see, I added two more fields. One is <code class="highlighter-rouge">name</code> and we will use it to reference our images inside the StructuredText. The other one is <code class="highlighter-rouge">caption</code>, that’s because I want to put one on my images but prismic didn’t allow me to do that at all by default. Thanks God, using this solution, I can finally do it, killing two birds with one stone. Now we can add as many responsive images as we want, yeah! Let’s grab some orange juice to celebrate!</p>

<h3 id="lets-hack-some-html">Let’s hack some HTML</h3>

<p>As I already said it, the next step will be to bring those images inside the StructuredText. We cannot do that directly inside the WYSIWYG editor but we can do it when rendering the final HTML. We will need two more things here:</p>

<ul>
  <li>having a placeholder inside the StructuredText to indicate we should insert an image</li>
  <li>extend the default HTML renderer to support such placeholder</li>
</ul>

<p>As for the placeholder, I decided to use a simple format like <code class="highlighter-rouge">{image-[name of the image]}</code>. Meaning that if the content of a paragraph inside my StructuredText is <code class="highlighter-rouge">{image-sunset}</code>, it will actually render the image named <code class="highlighter-rouge">sunset</code> from the group of images when generating the final HTML. Pretty easy right? Your writers might find it ugly, having to write those strange tags, and not seeing their images directly inside the StructuredText, but just tell them that’s for the greater good. You could, of course, use another syntax, eventually support attributes, whatever.</p>

<p>The final task, and probably the hardest one, is to extend the HTML rendering system. Each primisc fragment has its own way to render as HTML. Unfortunately, there is no way to extend it, you can only, eventually, override it. And the one for StructuredText is by far the most complex one. The easiest way to do that is to copy/paste the default one from the kit you are using (if you are not using any kit, you are free to do whatever you want, so it’s fine) and edit it. You will then edit the part responsible for rendering a paragraph, test if its content match our placeholder syntax, if so, render an image, if not, just render the text as it is. Since I’m using the JavaScript kit, here is the <a href="https://github.com/pauldijou/farewell/blob/9a744565d7e66f06aa9a3edf7e360db0f00c70aa/scripts/prismic.js#L65-L159">full copy/paste</a> but that’s the <a href="https://github.com/pauldijou/farewell/blob/9a744565d7e66f06aa9a3edf7e360db0f00c70aa/scripts/prismic.js#L105-L117">important part</a> where we are rendering the image. My <code class="highlighter-rouge">model</code> is actually a JavaScript class extracted from the original prismic Document, but you could use the raw Document of course.</p>

<h3 id="conclusion-and-limitations">Conclusion and limitations</h3>

<p>That’s pretty much it. Here is a quick summary of what to do:</p>

<ul>
  <li>inside the mask, add a Group of Images with, at least, a Text fragment for the name.</li>
  <li>choose a naming convention to write placeholders inside a StructuredText, ex: <code class="highlighter-rouge">{image-[name]}</code></li>
  <li>override the StructuredText HTML rendering function with a custom one inserting images from the Document when finding a placeholder</li>
  <li>you can add more attributes and render them (like a caption)</li>
</ul>

<p>What are the bad points / limitations of the solution?</p>

<ul>
  <li>writers need to write placeholders rather than having a nice UI to insert images</li>
  <li>images do not display natively in the WYSIWYG editor anymore</li>
  <li>you cannot re-order a Group fragment right now, meaning images will be sorted based on their created date and not on their place inside the StructuredText</li>
</ul>

  </div>

  <div class="footer">
    <span class="hidden-xs hidden-sm">
      <span class="icon fa fa-link fa-fw"></span>
      <a href="http://pauldijou.fr/blog/2014/08/04/prismicio-responsive-images-inside-structured-text/">Permalink</a>
    </span>
    <span class="separator"></span>

    <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-pencil-square-o fa-fw"></span></span>
    <a href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-08-04-prismicio-responsive-images-inside-structured-text.md" target="_blank" class="improve visible-md-inline visible-lg-inline">Improve this article</a>
    <a href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-08-04-prismicio-responsive-images-inside-structured-text.md" target="_blank" class="improve button block hidden-md hidden-lg">
      <span class="icon fa fa-pencil-square fa-fw"></span>
      Improve this article
    </a>

    
      <div class="tags">
        <span class="icon fa fa-tags fa-fw"></span>
        Tags:
        
          <a class="tag label label-default" href="/blog/tags/prismic/">prismic</a>
        
      </div>
    

  </div>

  
    
  <div class="pagination">
    <div class="row">
      <div class="col-xs-6">
        
          <a class="button block previous" href="/blog/2014/08/01/doing-conference-website-two-days/">Previous</a>
        

      </div>
      <div class="col-xs-6">
        
          <a class="button block next" href="/blog/2014/08/05/browser-sync-play-framework/">Next</a>
        
      </div>
    </div>
  </div>

  <div id="disqus_thread"></div>

  <script>
    // Learn more: https://disqus.com/admin/universalcode/#configuration-variables
    var disqus_config = function () {
      this.page.url = 'http://pauldijou.fr/blog/2014/08/04/prismicio-responsive-images-inside-structured-text/';  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = '/blog/2014/08/04/prismicio-responsive-images-inside-structured-text'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      this.page.title = 'Prismic.io: responsive images inside a StructuredText';
      // this.page.category_id = '';
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://pauldijou.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

  
</article>


<script id="dsq-count-scr" src="//pauldijou.disqus.com/count.js" async></script>

</div>


    <script type="text/javascript" src="/assets/js/main-a35bb44a42985a5ff06fe724109076616abccf20668ed9c7419518a3b125015d.js"></script>

    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->

    
  </body>
</html>
