<!DOCTYPE html>
<html>
  <head>


    <!-- HTML meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta name="author" content="">
    <meta name="description" content="" />
    

    <title>Paul Dijou - Posts tagged with prismic</title>

    <!-- facebook open graph tags http://ogp.me/ -->
    <meta property="og:site_name" content="Paul Dijou" />
    <meta property="og:title" content="Posts tagged with prismic" />
    <meta property="og:url" content="http://pauldijou.fr/blog/tags/prismic/index.html" />
    <meta property="og:description" content="" />
    
      <meta property="og:type" content="website" />
    
    
    

    <!-- twitter card tags https://dev.twitter.com/cards/markup -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@paul_dijou" />
    
    <meta name="twitter:title" content="Paul Dijou - Posts tagged with prismic" />
    <meta name="twitter:description" content="" />

    <link rel="shortcut icon" type="image/png" href="/assets/favicon-5b92c61126199f7d62a67cca38b3e33bbdd0f7a7a836dbda27ef0f09ffd3e5eb.ico"/>
    <link type="text/css" rel="stylesheet" href="/assets/css/main-e66cbeb83467c4596e317baff024f2f5aafbe0950e29acbcca992eddbcabe00c.css">
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400' rel='stylesheet' type='text/css'/>

    <!--[if lt IE 8]>
      <link href="/stylesheets/ie.css" media="screen, projection" rel="stylesheet" type="text/css">
    <![endif]-->

    

    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-25058935-1', 'auto');
        ga('send', 'pageview');
      </script>
    
  </head>
  <body>
    <header id="nav" class="nav">
  <ul class="list-unstyled">
    
      <li>
        <a href="/">
          <span class="icon fa fa-home fa-fw fa-2x"></span>
          <span class="nav-label">Home</span>
        </a>
      </li>
    
      <li>
        <a href="/blog/">
          <span class="icon fa fa-coffee fa-fw fa-2x"></span>
          <span class="nav-label">Blog</span>
        </a>
      </li>
    
      <li>
        <a href="/resume/">
          <span class="icon fa fa-code fa-fw fa-2x"></span>
          <span class="nav-label">Resume</span>
        </a>
      </li>
    
      <li>
        <a href="/projects/">
          <span class="icon fa fa-flask fa-fw fa-2x"></span>
          <span class="nav-label">Projects</span>
        </a>
      </li>
    
      <li>
        <a href="/about/">
          <span class="icon fa fa-user fa-fw fa-2x"></span>
          <span class="nav-label">About</span>
        </a>
      </li>
    
      <li>
        <a href="/contact/">
          <span class="icon fa fa-envelope fa-fw fa-2x"></span>
          <span class="nav-label">Contact</span>
        </a>
      </li>
    
      <li>
        <a href="/archives/">
          <span class="icon fa fa-archive fa-fw fa-2x"></span>
          <span class="nav-label">Archives</span>
        </a>
      </li>
    
    <li class="nav-back">
      <a href="#">
        <span class="icon fa fa-undo fa-fw fa-2x"></span>
        <span class="nav-label">Back to page</span>
      </a>
    </li>
  </ul>
</header>

<div class="nav-menu">
  <a href="#nav">Menu</a>
</div>

<div class="page container">
  <div class="posts">
  
    









<article class="post">
  <h2>
    <a href="/blog/2014/08/04/prismicio-responsive-images-inside-structured-text/">Prismic.io: responsive images inside a StructuredText</a>
  </h2>

  <div class="meta">
    Posted by
    <span class="author"></span>
    
      on
      <span class="date">Aug 04, 2014</span>
    
    <span class="separator"></span>

    
      <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-comments fa-fw"></span></span>
      <a href="/blog/2014/08/04/prismicio-responsive-images-inside-structured-text/#disqus_thread" data-disqus-identifier="/blog/2014/08/04/prismicio-responsive-images-inside-structured-text">Comments</a>
      <span class="separator"></span>
    

    <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-pencil-square-o fa-fw"></span></span>
    <a class="improve visible-md-inline visible-lg-inline" href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-08-04-prismicio-responsive-images-inside-structured-text.md" target="_blank">Improve this article</a>
  </div>

  <div class="content">
    <p>Once again, I will not explain what <a href="http://prismic.io">prismic.io</a> is (but it’s a tool to manage your website content), I will only focus on one limitation and how to solve it. If you don’t know about prismic.io, you should quickly check its website before reading any further.</p>

<h3 id="whats-the-problem">What’s the problem?</h3>

<p>In prismic.io, you are creating Documents which are composed of Fragments. A fragment is data organized in a more or less semantic way. For example, a fragment can be a Number, or a Date, … Among them, there is the type Image which is really nice because you can not only fully resize / crop your raw picture, but also add smaller images based on the original one for responsive purpose. You can upload your awesome photo of this beautiful sunset, fully sized at 4000 x 3000 pixels, resize it for desktop at 1920 x 1080, and finally add a mobile version at 320 * 480. Note that the last one doesn’t respect the ratio at all, but that’s the goal: you are creating a subset of your image with the best match possible regarding the targeted screen.</p>

<p>Another really powerful fragment in prismic is the StructuredText. It allows you to have a nice WYSIWYG editor inside which you will put new fragments (paragraphs, links, titles, images, …). It would be perfect if the image fragment inside a StructuredText was a real Image fragment, but it is not. You cannot specify any thumbnail. Meaning your content cannot be responsive at all. Your choice is: consume all the bandwith for mobiles with awesome full HD images or make the eyes of your desktop users bleed with super compressed images.</p>

<h3 id="you-dont-want-to-do-that">You don’t want to do that!</h3>

<p>And me neither! I want to have responsive images inside my StructuredText for God sake. I love tools which make my life easier, but they never should stand on my way to craft the best website possible. I will not lie to you, I couldn’t find any solution that integrates nicely with the WYSIWYG editor since there is no way to extend it. The following solution will be a bit of hacking and your writers might complain about it at first.</p>

<p>So, what’s the idea? The only way to have responsive images is to use a real Image fragment, no choice here. So let’s create one, and let’s put it inside a Group fragment. This way, you can add and remove as many images as you want and they will all be responsive. Wait, you can’t do that inside the StructuredText, right? Indeed, that’s why we will do outside of it and then find a way to bring back the images inside of it. Here is the mask for such a group:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"Images"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"images"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Group"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"fieldset"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Images"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"config"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"fields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Text"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"config"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Name"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="s2">"caption"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Text"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"config"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Caption"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="s2">"image"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Image"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"config"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"thumbnails"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mobile"</span><span class="w">
              </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tablet"</span><span class="w">
              </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p class="alert alert-info"><strong>Pro Tip</strong> - When creating thumbnails for an Image fragment, the <a href="https://developers.prismic.io/documentation/UjBeuLGIJ3EKtgBV/repository-administrators-manual#document-masks">offical documentation</a> states that both width and height are mandatory. This is <strong>wrong</strong>, you can specify only one of the two or even none of them. Your UI might be a bit ugly (the resized thumbnails will only display after saving your draft) and sometimes you will have to click twice on a button (this one, I really don’t understand) but otherwise, it works just fine. I hope prismic guys will make those attributes optional because… well… how can you anticipate how the writer wants to resize its image?</p>

<p>As you can see, I added two more fields. One is <code class="highlighter-rouge">name</code> and we will use it to reference our images inside the StructuredText. The other one is <code class="highlighter-rouge">caption</code>, that’s because I want to put one on my images but prismic didn’t allow me to do that at all by default. Thanks God, using this solution, I can finally do it, killing two birds with one stone. Now we can add as many responsive images as we want, yeah! Let’s grab some orange juice to celebrate!</p>

<h3 id="lets-hack-some-html">Let’s hack some HTML</h3>

<p>As I already said it, the next step will be to bring those images inside the StructuredText. We cannot do that directly inside the WYSIWYG editor but we can do it when rendering the final HTML. We will need two more things here:</p>

<ul>
  <li>having a placeholder inside the StructuredText to indicate we should insert an image</li>
  <li>extend the default HTML renderer to support such placeholder</li>
</ul>

<p>As for the placeholder, I decided to use a simple format like <code class="highlighter-rouge">{image-[name of the image]}</code>. Meaning that if the content of a paragraph inside my StructuredText is <code class="highlighter-rouge">{image-sunset}</code>, it will actually render the image named <code class="highlighter-rouge">sunset</code> from the group of images when generating the final HTML. Pretty easy right? Your writers might find it ugly, having to write those strange tags, and not seeing their images directly inside the StructuredText, but just tell them that’s for the greater good. You could, of course, use another syntax, eventually support attributes, whatever.</p>

<p>The final task, and probably the hardest one, is to extend the HTML rendering system. Each primisc fragment has its own way to render as HTML. Unfortunately, there is no way to extend it, you can only, eventually, override it. And the one for StructuredText is by far the most complex one. The easiest way to do that is to copy/paste the default one from the kit you are using (if you are not using any kit, you are free to do whatever you want, so it’s fine) and edit it. You will then edit the part responsible for rendering a paragraph, test if its content match our placeholder syntax, if so, render an image, if not, just render the text as it is. Since I’m using the JavaScript kit, here is the <a href="https://github.com/pauldijou/farewell/blob/9a744565d7e66f06aa9a3edf7e360db0f00c70aa/scripts/prismic.js#L65-L159">full copy/paste</a> but that’s the <a href="https://github.com/pauldijou/farewell/blob/9a744565d7e66f06aa9a3edf7e360db0f00c70aa/scripts/prismic.js#L105-L117">important part</a> where we are rendering the image. My <code class="highlighter-rouge">model</code> is actually a JavaScript class extracted from the original prismic Document, but you could use the raw Document of course.</p>

<h3 id="conclusion-and-limitations">Conclusion and limitations</h3>

<p>That’s pretty much it. Here is a quick summary of what to do:</p>

<ul>
  <li>inside the mask, add a Group of Images with, at least, a Text fragment for the name.</li>
  <li>choose a naming convention to write placeholders inside a StructuredText, ex: <code class="highlighter-rouge">{image-[name]}</code></li>
  <li>override the StructuredText HTML rendering function with a custom one inserting images from the Document when finding a placeholder</li>
  <li>you can add more attributes and render them (like a caption)</li>
</ul>

<p>What are the bad points / limitations of the solution?</p>

<ul>
  <li>writers need to write placeholders rather than having a nice UI to insert images</li>
  <li>images do not display natively in the WYSIWYG editor anymore</li>
  <li>you cannot re-order a Group fragment right now, meaning images will be sorted based on their created date and not on their place inside the StructuredText</li>
</ul>

  </div>

  <div class="footer">
    <span class="hidden-xs hidden-sm">
      <span class="icon fa fa-link fa-fw"></span>
      <a href="http://pauldijou.fr/blog/2014/08/04/prismicio-responsive-images-inside-structured-text/">Permalink</a>
    </span>
    <span class="separator"></span>

    <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-pencil-square-o fa-fw"></span></span>
    <a href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-08-04-prismicio-responsive-images-inside-structured-text.md" target="_blank" class="improve visible-md-inline visible-lg-inline">Improve this article</a>
    <a href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-08-04-prismicio-responsive-images-inside-structured-text.md" target="_blank" class="improve button block hidden-md hidden-lg">
      <span class="icon fa fa-pencil-square fa-fw"></span>
      Improve this article
    </a>

    
      <div class="tags">
        <span class="icon fa fa-tags fa-fw"></span>
        Tags:
        
          <a class="tag label label-default" href="/blog/tags/prismic/">prismic</a>
        
      </div>
    

  </div>

  
</article>

  
    









<article class="post">
  <h2>
    <a href="/blog/2014/07/26/prismicio-javascript-kit-from-callbacks-to-promises/">Prismic.io JavaScript kit: from callbacks to promises</a>
  </h2>

  <div class="meta">
    Posted by
    <span class="author"></span>
    
      on
      <span class="date">Jul 26, 2014</span>
    
    <span class="separator"></span>

    
      <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-comments fa-fw"></span></span>
      <a href="/blog/2014/07/26/prismicio-javascript-kit-from-callbacks-to-promises/#disqus_thread" data-disqus-identifier="/blog/2014/07/26/prismicio-javascript-kit-from-callbacks-to-promises">Comments</a>
      <span class="separator"></span>
    

    <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-pencil-square-o fa-fw"></span></span>
    <a class="improve visible-md-inline visible-lg-inline" href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-07-26-prismicio-javascript-kit-from-callbacks-to-promises.md" target="_blank">Improve this article</a>
  </div>

  <div class="content">
    <h3 id="holy-cow-callbacks">Holy cow, callbacks!</h3>

<p>For the last (and only) website I did using prismic.io, I didn’t want any back-end, all client-side, pure JavaScript man. This way, I could host it nearly anywhere for pretty much free (GitHub pages FTW). To ease stuff, I decided to use the <a href="https://github.com/prismicio/javascript-kit">JavaScript kit</a> from the prismic.io team.</p>

<p>One choice they made and that I don’t really like is using callbacks in it. For example, you have to write stuff like:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Get the current API</span>
<span class="nx">Prismic</span><span class="p">.</span><span class="nx">Api</span><span class="p">(</span><span class="s1">'/my/awesome/url'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle error</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Use the API there, retrieving documents</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">form</span><span class="p">(</span><span class="s1">'articles'</span><span class="p">).</span><span class="nx">ref</span><span class="p">(</span><span class="nx">api</span><span class="p">.</span><span class="nx">master</span><span class="p">()).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">articles</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Also error again</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// But I also need authors...</span>
    <span class="nx">api</span><span class="p">.</span><span class="nx">form</span><span class="p">(</span><span class="s1">'authors'</span><span class="p">).</span><span class="nx">ref</span><span class="p">(</span><span class="nx">api</span><span class="p">.</span><span class="nx">master</span><span class="p">()).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">authors</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// One more time, handle error</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// Now I got all my data</span>
      <span class="c1">// I can finally display it on my page</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">},</span> <span class="s1">'my_token_far_below_at_the_end'</span><span class="p">);</span></code></pre></figure>

<p>Can you see it? This ugly thing JavaScript experts name “callback hell”? And that’s a super simple example. In 2014, the way to do that is using Promises. That’s what’s hype (and readable, and nice, and cool, and swag). But I quite understand why they made this choice. Promises are not native everywhere yet, so going with it mean either writing your own implementation or imposing an existing one. Fair enough to have callbacks in the kit then, but we are hackers here, we can override it to use Promises!</p>

<p class="alert alert-danger">I will use the last spec Promise syntax, native way baby!, but it is really important to keep in mind that it has <a href="http://caniuse.com/#search=promises">a really poor support</a> right now. You should probably be using a Javascript library as Promise implementation. I will link a snippet of code using the <a href="http://documentup.com/kriskowal/q/">Q library</a> at the end of the article. But I wanted this article to be future proof.</p>

<h3 id="omg-promises-o">OMG, promises \o/</h3>

<p>There are two main callbacks in the kit: when retrieving the API and when making a <code class="highlighter-rouge">submit</code>. What I want to write is something like:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Api</span><span class="p">(</span><span class="s1">'/my/awesome/url'</span><span class="p">,</span> <span class="s1">'my_token_right_here_at_the_start'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
      <span class="nx">api</span><span class="p">.</span><span class="nx">form</span><span class="p">(</span><span class="s1">'articles'</span><span class="p">).</span><span class="nx">ref</span><span class="p">(</span><span class="nx">api</span><span class="p">.</span><span class="nx">master</span><span class="p">()).</span><span class="nx">submit</span><span class="p">(),</span>
      <span class="nx">api</span><span class="p">.</span><span class="nx">form</span><span class="p">(</span><span class="s1">'authors'</span><span class="p">).</span><span class="nx">ref</span><span class="p">(</span><span class="nx">api</span><span class="p">.</span><span class="nx">master</span><span class="p">()).</span><span class="nx">submit</span><span class="p">()</span>
    <span class="p">]);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">articles</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">authors</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="c1">// Display the results</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle error</span>
  <span class="p">});</span></code></pre></figure>

<p>Sooooo much more readable and swag… Overriding the Api callback is really simple:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Remove the callback from the function signature</span>
<span class="kd">function</span> <span class="nx">Api</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">accessToken</span><span class="p">,</span> <span class="nx">maybeRequestHandler</span><span class="p">,</span> <span class="nx">maybeApiCache</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Put a callback that will only resolve/reject the deferred depending</span>
    <span class="c1">// on the presence of an error or not</span>
    <span class="nx">Prismic</span><span class="p">.</span><span class="nx">Api</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">resolvedApi</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Save point 1 (see below)</span>
        <span class="nx">resolve</span><span class="p">(</span><span class="nx">resolvedApi</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="nx">accessToken</span><span class="p">,</span> <span class="nx">maybeRequestHandler</span><span class="p">,</span> <span class="nx">maybeApiCache</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre></figure>

<p>Overriding the <code class="highlighter-rouge">submit</code> call is a bit more tricky because it is a prototype function of the <code class="highlighter-rouge">SearchForm</code> object, which is totally hidden inside Prismic clojure. This is a bit (super) sad but we can deal with it by creating a fake form and not submitting it. The easiest way I found so far is doing it right after getting the Api. Let’s add the following code at <code class="highlighter-rouge">Save point 1</code> (see previous code).</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// You might need a polyfill for 'getPrototypeOf'</span>
<span class="c1">// if you support old browser</span>
<span class="kd">var</span> <span class="nx">SearchFormProto</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nx">resolvedApi</span><span class="p">.</span><span class="nx">forms</span><span class="p">(</span><span class="s1">'everything'</span><span class="p">));</span>
<span class="c1">// We are saving the original function so we can call it inside our override</span>
<span class="kd">var</span> <span class="nx">originalSubmit</span> <span class="o">=</span> <span class="nx">SearchFormProto</span><span class="p">.</span><span class="nx">submit</span><span class="p">;</span>

<span class="c1">// Let's override!</span>
<span class="nx">SearchFormProto</span><span class="p">.</span><span class="nx">submit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// As before, the callback will only resolve / reject the deferred</span>
    <span class="c1">// depending on the returned value</span>
    <span class="nx">originalSubmit</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">docs</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">(</span><span class="nx">docs</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span></code></pre></figure>

<p>And after that, you just need to use the new <code class="highlighter-rouge">Api</code> function in place of <code class="highlighter-rouge">Prismic.Api</code>. You can see <a href="https://github.com/pauldijou/farewell/blob/9a744565d7/scripts%2Fapi.js#L8-L32">the full code here</a> using <code class="highlighter-rouge">Q</code> library. This refers to a particular commit to ensure the line highlight is correct but you can freely switch to the master branch to see the most recent code (which shouldn’t be much different… but who knows…).</p>

<p>Thanks for reading. Next time we will talk about responsive images inside StructuredText.</p>

  </div>

  <div class="footer">
    <span class="hidden-xs hidden-sm">
      <span class="icon fa fa-link fa-fw"></span>
      <a href="http://pauldijou.fr/blog/2014/07/26/prismicio-javascript-kit-from-callbacks-to-promises/">Permalink</a>
    </span>
    <span class="separator"></span>

    <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-pencil-square-o fa-fw"></span></span>
    <a href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-07-26-prismicio-javascript-kit-from-callbacks-to-promises.md" target="_blank" class="improve visible-md-inline visible-lg-inline">Improve this article</a>
    <a href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-07-26-prismicio-javascript-kit-from-callbacks-to-promises.md" target="_blank" class="improve button block hidden-md hidden-lg">
      <span class="icon fa fa-pencil-square fa-fw"></span>
      Improve this article
    </a>

    
      <div class="tags">
        <span class="icon fa fa-tags fa-fw"></span>
        Tags:
        
          <a class="tag label label-default" href="/blog/tags/prismic/">prismic</a>
        
      </div>
    

  </div>

  
</article>

  
    









<article class="post">
  <h2>
    <a href="/blog/2014/07/17/prismicio-when-happiness-met-disappointment/">Prismic.io: when happiness met disappointment</a>
  </h2>

  <div class="meta">
    Posted by
    <span class="author"></span>
    
      on
      <span class="date">Jul 17, 2014</span>
    
    <span class="separator"></span>

    
      <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-comments fa-fw"></span></span>
      <a href="/blog/2014/07/17/prismicio-when-happiness-met-disappointment/#disqus_thread" data-disqus-identifier="/blog/2014/07/17/prismicio-when-happiness-met-disappointment">Comments</a>
      <span class="separator"></span>
    

    <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-pencil-square-o fa-fw"></span></span>
    <a class="improve visible-md-inline visible-lg-inline" href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-07-17-prismicio-when-happiness-met-disappointment.md" target="_blank">Improve this article</a>
  </div>

  <div class="content">
    <p class="alert alert-danger"><strong>Warning</strong> This article is pretty old. Prismic has evolved a lot since then and most issues have been addressed. <a href="https://prismic.io/docs">Check the last version of the docs</a>.</p>

<h3 id="tldr">TL;DR</h3>

<p>If you don’t know about <a href="https://prismic.io/">prismic.io</a>, it’s a nice tool providing both a super clean web interface to write content and an API to retrieve it. No front-end provided, eventually some kits to help you and some examples, but no more. Which is cool because, if you are a web developer, you can focus on crafting an awesome optimized website and then easily put some content in it… well, that’s the theory…</p>

<p>But for me, after using it for a new website, as good as the idea can be, I have found way too much limitations to consider it production ready. The team behind prismic.io is working on most of them so I really hope the implementation will become as awesome as its concept at some point in the future.</p>

<p>The rest of the article will focus on bashing all those limitations, so there will be way more bad than good, but don’t get me wrong, prismic.io has tons of good stuff, and it’s still in beta, I just want to talk about what I don’t like in this article. And since I’m not all about trolling, I will try to consider how to solve them at the end. I will not explain what prismic.io is exactly, so it might be for the best that you quickly check their website before continuing reading. Enjoy.</p>

<h3 id="do-you-remember-how-happy-we-were-at-the-beginning">Do you remember how happy we were at the beginning?</h3>

<p>I will never forget… it all started on this windy saturday… I was looking for a solution to create a new blog about traveling. I didn’t want to use an all-in-one tool because I love crafting my UI from scratch, with exactly what I want on it (this point is super important for the rest of the story). I said bybye to Wordpress and all its friends. If I were alone, I would have probably go with raw Markdown or whatever, but I am not… I have other people that travel with me and want to write articles without learning a super complex geek syntax. I will call them… <em>writers</em>. Some colleagues of mine told me about you… that you might be the future of content management, that I would be free for the UI, that you had WISIWIG editors and stuff for… <em>writers</em>, sounds like a perfect match, and so our adventure began.</p>

<p>I still can’t believe how fast it all went… in a couple of hours, we were able to write new articles and display them in a custom website hosted in GitHub pages. Using one of your kits, it was so easy to query your API, retrieve the content as JSON and inject it inside Handlebars templates in order to render the final HTML. Oh man… it was so good.</p>

<h3 id="and-then-fictions-appeared">And then fictions appeared</h3>

<p>A few days later, I wanted to go further, moving forward to more crazy stuff. I know that sometimes I try to do complex features just for the fun of the challenge it provides me, but still, how could you do that to me… Remember this conversation?</p>

<ul>
  <li>Hey prismic.io, I would like to query documents that does not match this predicate</li>
  <li>Ahahah, you so funny, no way…</li>
  <li>Thanks! Wait… what? Why not?</li>
  <li>I don’t have a <code class="highlighter-rouge">NO</code> operator or whatever close to it.</li>
  <li>Whyyyyyy? You have crazy operators like <code class="highlighter-rouge">similar</code> to retrieve similar documents based on God know which algorithm and you cannot do a simple negation?</li>
  <li>Nope. Deal with it.</li>
  <li>Okay… I think I can manage something if the query match this <code class="highlighter-rouge">OR</code> that. That’s fine, right?</li>
  <li>No.</li>
  <li>Cool! Wait… what?</li>
  <li>I only have <code class="highlighter-rouge">AND</code> operators between predicates.</li>
  <li>You gotta be kidding me…</li>
</ul>

<p>I was a bit sad, but I could manage it, retrieving too much documents and filtering client-side. Still, that was the starting point were all went wrong.</p>

<h3 id="my-biggest-mistake-using-structuredtext">My biggest mistake: using StructuredText</h3>

<p>All contents in prismic.io must be typed. This is an image, this is a number, etc… A StructuredText is probably the most powerful type since it allows writers to enter complex content through a WISIWIG editor, using paragraphes, images, lists, embedded stuff, … They can style it using bold, italic, and so on. It looks nice, right? So I decided to use it for the main content of my articles. Fair enough. As always, it was so great to have writers doing their own design using the editor, and so easy to render it automatically as HTML (except for some bugs here and there, but that’s what pull requests are for, isn’t it?). At some point, I just wanted to have a lightbox on some images: clicking on them should expand it to its full sized version with a caption. I don’t know for you, but for me, this is a really basic requirement and you should be able to do it in less than 2 hours.</p>

<p>First problem: I wanted to tag images that should have lightbox with <code class="highlighter-rouge">[data-lightbox]</code> HTML attribute, all images didn’t need one. Since I was using the JavaScript kit to render my HTML, I couldn’t do that at all. There is no way to add custom rendering or plugins in the HTML renderer from the kit. Dammit. So I rewrote the full renderer so I could customize it… Wait, how can I indicate which image has a lightbox and which hasn’t inside a StructuredText? Oh, right, I just can’t. Inside a StructuredText, you can only drop raw images and resize them, that’s it. Does that mean I cannot put nor caption or title? Yep, no way to do it. So I started to hack: if after an image, the following paragraph would begin with <code class="highlighter-rouge">[caption]</code>, the image would be a lightbox, the content of the paragraph would be its legend, and the paragraph itself would be removed from the final rendering.</p>

<p>Guess what? Writers didn’t really like having to manually write <code class="highlighter-rouge">[caption]</code>, they wanted a nice UI to do that… but that was just impossible… They throw some tomatoes at me and we tried to move on but we couldn’t… Solving one problem to discover a new one: when you define a type <code class="highlighter-rouge">image</code> in a Document, you can tell that it will have different sizes: one for desktop, one for tablet and one for smartphone for example. And that’s awesome because you can fully optimize for mobile, which is super important nowadays. Do you think you can do that with image inside StructuredText? Indeed, the answer is no! Once again, a great idea not fully supported. Is there a workaround? Sadly, no easy one. You can upload the same image several times, one for each size, then find a way to retrieve its generated ID by prismic.io and use the same hack as <code class="highlighter-rouge">[caption]</code> to specify it and hack a bit more the HTML renderer. I couldn’t find the courage to do it… pretty sure tomatoes would have been replaced by rocks from writers. I can only hope my mobile users have 4G now.</p>

<p>Want more? No biggy, I have tons of stories like that. A writer wanted to have blockquotes: a whole paragraph should be displayed in a custom design and have an author. I had to kill him really fast and bury his body deep. Another one wanted semantic distinction between paragraphs, something like: this one should be red and this one blue just because. Thrown him into a bucket full of piranhas. At some point, a writer became a madman and deleted half of documents… no way to find him since the delete operation does not appear in the timeline. But who cares? I mean, the document are gone anyway. I18N, do you speak it? I hope not because there is <a href="https://qa.prismic.io/29/will-multi-lingual-sites-be-supported-in-the-future">no support for it… yet</a>. Want to put some tables? Could you please <a href="https://qa.prismic.io/25/how-do-we-best-support-tables">stop joking</a>, it hurts me to laugh so much. Want do  <a href="https://qa.prismic.io/55/improve-the-media-library">manage hundred of images</a> in the media library? Might be less painful to jump from the top of the <a href="http://en.wikipedia.org/wiki/Eiffel_Tower">Eiffel tower</a>. And so on, and so on…</p>

<h3 id="we-didnt-fully-link-anymore">We didn’t fully link anymore</h3>

<p>Writers are generally really proud of their work, so they want everybody to know about it. I couldn’t just display “Title of the article”. If I wanted to stay alive, I needed to display “Title of the article, by an awesome author”, and if you would click on the name, you would access to a page saying how incredible the author was. As always, I was like “No biggy dudes, this is gonna be easy”. I wasn’t bluffing at that point since there is this nice feature that allow you to link documents between them. So every author would now have a dedicated document of type Author, where he could write whatever description he wanted, and each document of type Article would be linked to an Author. So far, so good.</p>

<p>And then the problem: if I get a list of Articles, I only got ids and a link to the Author resources, but I do not actually have the data on the Author document, which means I cannot display the real name of the author. And guess what? There is no aggregation or join possible in the API. You just cannot say that you want the 20 most recent articles with their authors. Solutions are: request all authors and then retrieve the good ones from ids (that’s 2 requests, and I did that since I don’t have that many authors), or do N+1 request (1 for articles, N for authors, one per author id from articles), or generate dynamically a request for authors using <code class="highlighter-rouge">any</code> operator (something like <code class="highlighter-rouge">[:d = any(my.author.id, [id1, id2, ...])]</code>). In any case, you need multiple requests, eventually not running in parallel, and with too much payload… mobile first, right?</p>

<h3 id="i-never-though-you-would-mask-it-from-me">I never though you would mask it from me…</h3>

<p>One core concept in prismic.io is Document Mask. Each document must have one and it represents its pattern, how it will be persisted in prismic.io database and how it will be served by the API. So you start creating masks, easy. It directly provides a slick UI for writers to enter content. Nice! And at some point, you realize you could have done better, the mask can be improved. Just don’t do that, keep going with your broken mask, trust me!</p>

<p>Let’s say you don’t trust me (that’s fair enough, you don’t even really know me). If you rename any property of the mask, you are screwed. The new property will be empty since it doesn’t consider it a renaming but the suppression of the previous property and the creation of a new empty one. But you are super courageous, so you migrate all your documents to the new property, yeah! Now you have duplicate a property in your API. Hell yeah! Just check the raw JSON, you will see the new property (thanks God) but also the old one. Properties just keep adding, prismic.io never forget… <strong>never!</strong> Your payload will just increase. And be sure that your front-end developers always only rely on the mask definition, never on the data from the API, because… it doesn’t mean anything anymore.</p>

<h3 id="my-heart-was-so-fragmented">My heart was so fragmented…</h3>

<p>So, let’s summarize what’s the biggest problem with prismic.io: you can only do what the tool allow you to do. And right now, it allows you only super basic features. Which are needed obviously, but when you go to the real world, you know, outside of the matrix, those are just not enough. Imagine being Mario, you need to save the princess but you can only move forward, no jump, no strange mushroom, no yoshi… Good luck! Direct consequence, the killer feature that would make prismic.io really powerful, in my humble opinion, is what I will call “custom fragments”. The idea is to allow developers to create their own type of fragments and plug them both in the UI of the writing room and in the HTML renderer. That might sounds a bit challenging but it isn’t that hard in fact.</p>

<p>So first, how to create a custom fragment? Let’s use the mask system. When defining a document, you are creating a mask saying “this document will have an image and some text as title”. Why not doing the same for custom fragments? Remember the lightbox problem? I would create a custom fragment <code class="highlighter-rouge">lightbox</code> which is composed of an image and some text as its caption. Even better, since I am now using a real <code class="highlighter-rouge">image</code> type, I can specify several sizes for the image. Big win here.</p>

<p>Next, inside the writing room, how to render a custom fragments? Well, you already know how to render all its pieces, just group them together with an indentation or a left border or whatever. The <code class="highlighter-rouge">lightbox</code> fragment would be an image selector and a text input. Of course, you should be able to put a custom fragment both inside a document (like any other fragment) and inside a StructuredText if possible (just like you are allowing <code class="highlighter-rouge">em</code> or <code class="highlighter-rouge">h2</code> inside a StructuredText)</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Let's define our custom fragment for lightbox,</span>
<span class="c1">// just the same syntax as a Document Mask</span>
<span class="p">{</span>
  <span class="s2">"title"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"Text"</span><span class="p">,</span>
    <span class="s2">"fieldset"</span> <span class="p">:</span> <span class="s2">"Title"</span><span class="p">,</span>
    <span class="s2">"config"</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">"placeholder"</span> <span class="p">:</span> <span class="s2">"A short caption for the image"</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">"image"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"fieldset"</span> <span class="p">:</span> <span class="s2">"Image"</span><span class="p">,</span>
    <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"Image"</span><span class="p">,</span>
    <span class="s2">"config"</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">"thumbnails"</span> <span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
        <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"Icon"</span><span class="p">,</span>
        <span class="s2">"width"</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">"height"</span> <span class="p">:</span> <span class="mi">100</span>
      <span class="p">},</span> <span class="p">{</span>
        <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"Column"</span><span class="p">,</span>
        <span class="s2">"width"</span> <span class="p">:</span> <span class="mi">320</span><span class="p">,</span>
        <span class="s2">"height"</span> <span class="p">:</span> <span class="mi">320</span>
      <span class="p">},</span> <span class="p">{</span>
        <span class="s2">"name"</span> <span class="p">:</span> <span class="s2">"Wide"</span><span class="p">,</span>
        <span class="s2">"width"</span> <span class="p">:</span> <span class="mi">600</span><span class="p">,</span>
        <span class="s2">"height"</span> <span class="p">:</span> <span class="mi">300</span>
      <span class="p">}</span> <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Finally, each kit should have a <code class="highlighter-rouge">renderFragment(type, json =&gt; html)</code> method that allow you, for a specific fragment type (here <code class="highlighter-rouge">lightbox</code>), to pass a function that know how to render the final HTML from its raw JSON.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Define how to render your custom fragment</span>
<span class="c1">// from JSON to HTML (which is a String)</span>
<span class="nx">kit</span><span class="p">.</span><span class="nx">renderFragment</span><span class="p">(</span><span class="s1">'lightbox'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">'&lt;img src="'</span><span class="p">;</span>
  <span class="nx">html</span> <span class="o">+=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
  <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'" data-lightbox title="'</span><span class="p">;</span>
  <span class="nx">html</span> <span class="o">+=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
  <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'"&gt;'</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
<span class="p">});</span></code></pre></figure>

<p>Hey, we can do even better, let’s add a second argument to the rendering function, this one will be the original rendering function for “native” fragments in prismic.io. This way, you can override just one or two “native” fragments. For example, if you want to render <code class="highlighter-rouge">image</code> with a <code class="highlighter-rouge">&lt;picture&gt;</code> HTML tag because that’s super hype. Just do something like:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Override an already existing fragment</span>
<span class="nx">kit</span><span class="p">.</span><span class="nx">renderFragment</span><span class="p">(</span><span class="s1">'image'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'&lt;picture&gt;'</span><span class="p">;</span>
  <span class="c1">// Keep it easy, only one source...</span>
  <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'&lt;source src="'</span> <span class="o">+</span> <span class="nx">json</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s1">'"&gt;'</span>
  <span class="c1">// Fallback using the default renderer</span>
  <span class="nx">html</span> <span class="o">+=</span> <span class="nx">original</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
  <span class="c1">// And the alt text</span>
  <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'&lt;p&gt;'</span> <span class="o">+</span> <span class="nx">json</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">alt</span> <span class="o">+</span> <span class="s1">'&lt;/p&gt;'</span>
  <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'&lt;/picture&gt;'</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
<span class="p">});</span></code></pre></figure>

<p>And that’s it! You just solved so many limitations…</p>

<h3 id="i-didnt-understand-your-semantic-anymore">I didn’t understand your semantic anymore…</h3>

<p>Ok, next step. Inside a StructuredText, I need to have semantic distinction between fields of the same type. This paragraph is <em>important</em>, this one is <em>a blockquote</em> and all the rest are <em>normal</em>. Let’s go the easy way: I just need a hash of key -&gt; value, as strings, to reach a limitless world. This way, I could tag one paragraphe <code class="highlighter-rouge">important: true</code>, and another with with both <code class="highlighter-rouge">blockquote: true</code> and <code class="highlighter-rouge">author: Someone</code>. At last but not least, expose it in the API:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Since all fields have a common structure to expose their type</span>
<span class="c1">// it's easy to have a new key like 'attributes' at this level</span>
<span class="c1">// to expose the semantic hash</span>
<span class="c1">// (btw, it would be cool to map to primitives rather than only string for values)</span>
<span class="p">{</span>
  <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"paragraph"</span><span class="p">,</span>
  <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"bla bla bla..."</span><span class="p">,</span>
  <span class="s2">"spans"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">"attributes"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"blockquote"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">"author"</span><span class="p">:</span> <span class="s2">"Someone"</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>I have no idea how to integrate that in the UI of the writing room, but I know its designer, he will figure out something awesome, no doubt.</p>

<p>By adding that, you leverage tons of possibilities for developers to customize the rendering of a StructuredText without any heavy hack. Writers would still need to manually write each key name, but its way better than paragraphs starting with <code class="highlighter-rouge">[caption]</code> or <code class="highlighter-rouge">[author]</code>. Following a snippet on how to render a blockquote, using the previous <code class="highlighter-rouge">renderFragment</code> method of course:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">kit</span><span class="p">.</span><span class="nx">renderFragment</span><span class="p">(</span><span class="s1">'paragraph'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">blockquote</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">'&lt;blockquote&gt;'</span><span class="p">;</span>
    <span class="c1">// Previously private (at least in the JavaScript kit),</span>
    <span class="c1">// I hope this method will be available in all kits</span>
    <span class="c1">// it applies all span styles to the raw text</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="nx">kit</span><span class="p">.</span><span class="nx">insertSpans</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">text</span><span class="p">,</span> <span class="nx">json</span><span class="p">.</span><span class="nx">spans</span><span class="p">);</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'&lt;footer&gt;'</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">author</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'&lt;/footer&gt;'</span><span class="p">;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'&lt;/blockquote&gt;'</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">html</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">original</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>This feature is for “quick and dirty” hacks if you could say, and allowing you to customize “native” fragments. Because otherwise, you could also have done that with a custom fragment. Rather than having two attributes, a <code class="highlighter-rouge">blockquote</code> could be a custom fragment grouping a StructuredText for the content and a simple text for the author. It is way more intuitive in the UI and it’s easier to create its own <code class="highlighter-rouge">renderFragment</code>.</p>

<p>I like a lot this <code class="highlighter-rouge">renderFragment</code> method, but I think we can make it even better! Right know, we can only specify / override for all the application. That’s super cool but limited… and if you have read carefully until now, you should know that I don’t like limitations. This method should be at least at 3 different levels:</p>

<ul>
  <li>Document instance</li>
  <li>Document type</li>
  <li>(Collection?)</li>
  <li>Application</li>
</ul>

<p>Here is the idea: when an instance of a Document wants to render some fields (or fragments) as HTML, it will do the following simple procedure:</p>

<ul>
  <li>Hey, do I have a custom renderer method for this type of field on myself? (yeah, because now each Document instance have the method). If so, use it, if not, continue.</li>
  <li>I am a Document of type Article, does this type of Document has such a method on it? (yeah, because now you can call this method for just a particular type of Document). Yes, use, no continue.</li>
  <li>Eventually, does my Collection have the method?</li>
  <li>Nearly finished, does the method is defined at the application level?</li>
  <li>If nothing found so far, if it is a native prismic.io field, render it as it should be, otherwise just crash or return empty string, I don’t know, it shouldn’t happen anyway.</li>
</ul>

<p>Holy crap… we just created a “rendering context with awesomeness inheritance” or something like that. Can you imagine all the things you could do with that? Can you ?! I can’t… it’s too big…</p>

<h3 id="lets-break-up">Let’s break up</h3>

<p>I could say more, but since it’s a miracle that you are still reading and it would not be as relevant as what I already said, I will stop here.</p>

<p>My conclusion so far: prismic.io is not ready for the real world and for real websites but there is a lot of work going on by its team so, as they say on half of their responses: stay tuned! It might become super awesome at some point (I hope it will).</p>

<p>Thanks for reading! See you soon for more hacky coding posts.</p>

  </div>

  <div class="footer">
    <span class="hidden-xs hidden-sm">
      <span class="icon fa fa-link fa-fw"></span>
      <a href="http://pauldijou.fr/blog/2014/07/17/prismicio-when-happiness-met-disappointment/">Permalink</a>
    </span>
    <span class="separator"></span>

    <span class="visible-md-inline visible-lg-inline"><span class="icon fa fa-pencil-square-o fa-fw"></span></span>
    <a href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-07-17-prismicio-when-happiness-met-disappointment.md" target="_blank" class="improve visible-md-inline visible-lg-inline">Improve this article</a>
    <a href="https://github.com/pauldijou/pauldijou.github.com/edit/develop/_posts/2014-07-17-prismicio-when-happiness-met-disappointment.md" target="_blank" class="improve button block hidden-md hidden-lg">
      <span class="icon fa fa-pencil-square fa-fw"></span>
      Improve this article
    </a>

    
      <div class="tags">
        <span class="icon fa fa-tags fa-fw"></span>
        Tags:
        
          <a class="tag label label-default" href="/blog/tags/prismic/">prismic</a>
        
      </div>
    

  </div>

  
</article>

  
</div>

<ul class="list-inline pagination text-center visible-xs visible-sm">
  <li>
    
      <span class="button disabled">
        <span class="icon fa fa-angle-left fa-lg"></span>
        Previous
      </span>
    
  </li>

  <li>
    
      <span class="button disabled">
        Next
        <span class="icon fa fa-angle-right fa-lg"></span>
      </span>
    
  </li>
</ul>

<ul class="list-inline pagination text-center hidden-xs hidden-sm">
    
      <li>
        <span class="button disabled">
          <span class="icon fa fa-angle-double-left fa-lg"></span>
          First
        </span>
      </li>
      <li>
        <span class="button disabled">
          <span class="icon fa fa-angle-left fa-lg"></span>
          Previous
        </span>
      </li>
    

    <li>
      <span class="button">1 of 1</span>
    </li>

    
      <li>
        <span class="button disabled">
          Next
          <span class="icon fa fa-angle-right fa-lg"></span>
        </span>
      </li>
      <li>
        <span class="button disabled">
          Last
          <span class="icon fa fa-angle-double-right fa-lg"></span>
        </span>
      </li>
    
</ul>

<div style="margin-bottom:20px;text-align:center;">
  <a class="button" href="http://feeds2.feedburner.com/pauldijou">
  <span class="icon fa fa-rss fa-lg"></span>
  Subscribe
</a>

</div>

<script id="dsq-count-scr" src="https://pauldijou.disqus.com/count.js" async></script>


</div>


    <script type="text/javascript" src="/assets/js/main-a35bb44a42985a5ff06fe724109076616abccf20668ed9c7419518a3b125015d.js"></script>

    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->

    
  </body>
</html>
